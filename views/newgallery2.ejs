<!DOCTYPE html>
<html lang="en">
<head>
	<title>LKB Photography gallery tool</title>
	<link rel="stylesheet" type="text/css" href="css/CSGalleryMaker.css">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="lib/jquery-ui-1.12.1/jquery-ui.js"></script>
	<script type="text/javascript" src="lib/packery.pkgd.min.js"></script>
	<script type="text/javascript" src="lib/imagesloaded.pkgd.js"></script>
	<script type="text/javascript" src="js/galleryMaker2.js"></script>
</head>

<body>

	<div>
		<h2>LKB Photography gallery tool: <span id="galleryName"><%=gallery.name%></span></h2>

		<form id="layoutForm" action="updateLayout">
			<label for="columns">Columns: </label>
			<input type="radio" name="columns" value="3" class="colBtn" id="colBtn3" checked>3
			<input type="radio" name="columns" value="4" class="colBtn" id="colBtn4">4
		</form>

		<form id="saveForm" action="/savegallery" method="POST">
			<div>
				<label for="displayName">Gallery display name: </label>
				<input type="text" name="displayName">
			</div>
			<input id="saveGalleryBtn" type="submit" value="Save gallery" disabled>
		</form>
		
	</div>

	<div id="container">
		<ul id="thumbs">
			<div class="thumbSizer col3"></div>
			<div class="thumbGutter"></div>
 		</ul>
 		<ul id="unusedThumbs">
			<div class="thumbSizer col3"></div>
			<div class="thumbGutter"></div>
 		</ul>
	</div>



	<script type="text/javascript">

		$(() => {
			//	Load gallery object from server
			let encodedXML = "<%=gallery.xml%>";
			let $xml = $(unescapeHTML(encodedXML));
			var gallery = {
				name: "<%=gallery.name%>",
				parent: "<%=gallery.parent%>",
				cols: $xml.find('gallery').attr('columns'),
				photos: [],
				xml: unescapeHTML(encodedXML)
			}
			console.log(gallery);
			//	Iterate photos and add objects to gallery's photo array
			$xml.find('gallery photo').each((index, photo) => {
				let photoObj = {
					'position': parseInt($(photo).attr('position')),
					'displayed': $(photo).attr('displayed') === 'true' ? true : false,
					'filename': $(photo).text()
				}
				gallery.photos.push(photoObj);
			});
			//	Sort photos by position
			gallery.photos.sort(compare);
			//	Add photos to DOM
			gallery.photos.forEach(photo => {
				let path = '../' + photo.filename;
				let element = 
					'<li class="thumb col' + gallery.cols + '" data-position="' + photo.position + '">' +
					'<img src="' + gallery.parent + '/' + gallery.name + '/' + photo.filename + '">' + 
					'<div class="positionLabel"><span></span></div>' +
					'<div class="toggleBtn removeBtn"></div>' +
					'</li>';
				$('#thumbs').append(element);
				//	If photo is not to be displayed, add 'removed' class (greyed etc)
				if(!photo.displayed) {
					$('.thumb').last().addClass('removed');
					$('.thumb').last().attr('data-position', '-');
					$('.thumb').last().appendTo('#unusedThumbs');
				}
			});
			console.log(gallery.photos);
			$('#thumbs').imagesLoaded(() => {
				loadGalleryMaker(gallery);
			});
		});

	</script>


</body>
</html>




